<!DOCTYPE html>
<html lang='en'>

<head>
    <title>MetaMask Sign Transaction</title>
    <script src='bundle.js' type='text/javascript'></script>
    <script>
        async function run() {
            window.web3 = new Web3(ethereum)
            let addr = await web3.eth.getCoinbase()
            let abi = await util.getABI('/contract-rpc/ERC20.json')
            console.log(abi)

            let token = new web3.eth.Contract(abi, '0xE9b8a874F1619d92df8D8237db46B770d9Bae52a')
            window.token = token

            token.methods.name().call((err, name) => {
                util.message(`<strong>Token Name:</strong> ${name}`)
                console.log(name)
            })

            token.methods.totalSupply().call((err, amount) => {
                util.message(`<strong>Total Supply</strong> ${amount}`)
            })

            var value = '100'
            var toAddress = addr // send tokens to self
            await token.methods.transfer(toAddress, value)
                .send({
                    from: addr
                }, (err, txHash) => {
                    if (err) console.error(err)

                    if (txHash) {
                        console.log('Transaction sent')
                        console.dir(txHash)
                    }
                })
        }
        run()
    </script>
</head>

<body id='messages'>

</body>